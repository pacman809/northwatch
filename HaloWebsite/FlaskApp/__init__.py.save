from flask import Flask, request, render_template, flash, redirect
from performance import performance
from blockStats import blockResults
from dailytx import dailyTransactions
from toetoken import balanceInfo
from web3 import Web3
from getType import GetType
from TransStats import TransResults
from heth import solvency
from explorerdryrun import 
app = Flask(__name__)
app.config["DEBUG"] = True



#---------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------


@app.route("/robots.txt") 
def robots_txt():
    return render_template("robots.txt")


#---------------------------------------------------------------------------------------------------------------------------


@app.route('/')
def index():

    block = performance()
    return render_template('index.html', block= block)


#---------------------------------------------------------------------------------------------------------------------------


@app.route('/beta')
def main():

	#text = request.form['text']
	#text = request.form.get('textbox')
	

	transactions = dailyTransactions()
	result = performance()
	return render_template('main.html', result= result, transactions= transactions)

	
#---------------------------------------------------------------------------------------------------------------------------


@app.route('/block/<id>')

def block(id):
	
	

	block = int(id)
	result = blockResults(block)
	transactions = result
	current = performance()
	data = result["input"]
	inputData = GetType(data)	

	if result is not  None:
		confirmations = current["BLOCKNUMBER"] - result["number"]
		status = "Database"
		value = Web3.fromWei(result["value"], 'Ether')
		return render_template('block.html', result= result, id= id, status= status, confirmations= confirmations, value= value, inputData= inputData )

	else:
		status = "Not Databased RPC call coming"	
		return render_template('block.html', result= result, id= id, status= status)


@app.route('/beta', methods=['POST'])
def form_post():

	text = request.form['input']
	return redirect("http://www.haloexplorer.com/block/{}".format(text))


#---------------------------------------------------------------------------------------------------------------------------


@app.route('/balance/<id>')

def balance(id):

	balance = balanceInfo(id)
	return render_template('balance.html', balance= balance, address= id)
	balance.clear()
	balance = {}


#--------------------------------------------------------------------------------------------------------------------------------

@app.route('/tx/<id>')

def transResolve(id):

	#results = TransResults("0x24d185ebe2c0da0ce63f59793abda63062484cf4d8c50d2f4a1c6ea4f1a6c4f9")
	results = TransResults(id)
	value = Web3.fromWei(results["value"], 'Ether')
	return render_template('transaction.html', results= results, value= value)

#-------------------------------------------------------------------------------------------------------------------------------

@app.route('/solvency')

def solvent():

	result = solvency()
	return render_template('solvent.html', result= result)

if __name__ == '__main__':
   app.run()


